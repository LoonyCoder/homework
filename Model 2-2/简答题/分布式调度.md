### 分布式调度

**分布式调度**有两种表现形式：
- 应用角度：同一个调度任务执行在分布式集群环境（本质上是同一个任务，但是运行在多实例环境下）
- 任务角度：对同一个调度任务分布式拆分（对一个调度任务拆分成很多个独立的子任务）

**分布式调度**优点：
- 保证系统的高可用
- 提高系统容错


**以Elastic-job-lite为例**

![job](https://img-blog.csdn.net/20170311022123242)

Elastic-job-lite属于轻量级去中心化的分布式协调服务，依赖zookeeper进行分布式调度协调和服务自发现，具备弹性扩缩容和失效转移等功能，也可以通过任务分片与业务层解耦。

**弹性分布式实现**
- 第一台服务器上线触发主服务器选举。主服务器一旦下线，则重新触发选举，选举过程中阻塞，只有主服务器选举完成，才会执行其他任务。

- 某作业服务器上线时会自动将服务器信息注册到注册中心，下线时会自动更新服务器状态。

- 主节点选举，服务器上下线，分片总数变更均更新重新分片标记。

- 定时任务触发时，如需重新分片，则通过主服务器分片，分片过程中阻塞，分片结束后才可执行任务。如分片过程中主服务器下线，则先选举主服务器，再分片。

- 通过上一项说明可知，为了维持作业运行时的稳定性，运行过程中只会标记分片状态，不会重新分片。分片仅可能发生在下次任务触发前。

- 每次分片都会按服务器IP排序，保证分片结果不会产生较大波动。

- 实现失效转移功能，在某台服务器执行完毕后主动抓取未分配的分片，并且在某台服务器下线后主动寻找可用的服务器执行任务。

单节点环境：
![job](https://img-blog.csdn.net/20170311024524057)

增加一个实例：
![job](https://img-blog.csdn.net/20170311024527737)



